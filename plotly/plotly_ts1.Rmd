---
title: "Plotly Dashboard"
output: 
  html_document:
    code_folding: show
    theme:
      bg: "white"
      fg: "black"
      primary: "steelblue"
      secondary: "forestgreen"
      base_font:
        google: Prompt
      heading_font:
        google: Proza Libre
---

This dashboard uses Plotly package, with example data and Gapminder data to illustrate interactive charts.  Note the font use, color choices and animation button and slider control.

```{r setup, include=FALSE}
if (requireNamespace("thematic")) 
  thematic::thematic_rmd(font = "auto")
```

```{r echo=FALSE, message=FALSE}
library(plotly)

df <- read.csv("https://plotly.com/~public.health/17.csv", skipNul = TRUE, encoding = "UTF-8")

labels <- function(size, label) {
  list(
    args = c("xbins.size", size), 
    label = label, 
    method = "restyle"
  )
}

fig <- df %>%
  plot_ly(
    x = ~date,
    autobinx = FALSE, 
    autobiny = TRUE, 
    marker = list(color = "rgb(68, 68, 68)"), 
    name = "date", 
    type = "histogram", 
    xbins = list(
      end = "2016-12-31 12:00", 
      size = "M1", 
      start = "1983-12-31 12:00"
    )
  )
fig <- fig %>% layout(
  paper_bgcolor = "rgb(240, 240, 240)", 
  plot_bgcolor = "rgb(240, 240, 240)", 
  title = "<b>Shooting Incidents</b><br>use dropdown to change bin size",
  xaxis = list(
    type = 'date'
  ),
  yaxis = list(
    title = "Incidents"
  ),
  updatemenus = list(
    list(
      x = 0.1, 
      y = 1.15,
      active = 1, 
      showactive = TRUE,
      buttons = list(
        labels("D1", "Day"),
        labels("M1", "Month"),
        labels("M6", "Half Year"),
        labels("M12", "Year")
      )
    )
  )
)

fig


```
```{r}
library(gapminder)
library(descr)
library(RColorBrewer)
descr::freq(gapminder$continent)

library(plotly)

df <- gapminder 

t <- list(
  family = "Palatino",
  size = 14)
fig <- df %>%
  plot_ly(
    x = ~gdpPercap, 
    y = ~lifeExp,
    size = ~pop, 
    color = ~continent, 
    colors = c("slateblue3", "steelblue", "firebrick", "forestgreen", "turquoise1"), 
    alpha=.5,
    frame = ~year, 
    text = ~country, 
    hoverinfo = "text",
    type = 'scatter',
    mode = 'markers',
    fill = ~''
  )
fig <- fig %>% layout(
  xaxis = list(
    type = "log"
  ), font = t
)


fig <- fig %>% layout(legend = list(orientation = 'h'))

fig <- fig %>% animation_button(
  x = 1, xanchor = "right", y = 0, yanchor = "bottom"
)
fig <- fig %>% animation_slider(
  currentvalue = list(prefix = "YEAR ", font = list(color="red"))
)
fig


```


